CREATE DATABASE DOM;

CREATE TABLE BUILDYEAR(BY_ID INT PRIMARY KEY, BY_BOTTOM_BORDER INT, BY_TOP_BORDER INT, BY_YEAR_COEFFICIENT FLOAT);
CREATE TABLE PROPERTY(PR_ID INT PRIMARY KEY, PR_SQUARE FLOAT, PRICE FLOAT, PR_BUILD_YEAR INT);

DROP TABLE BUILDYEAR;
DROP TABLE PROPERTY;

INSERT INTO BUILDYEAR
VALUES(1, 2010, 2019, 1),
(2, 2000, 2009, 0.9),
(3, 1990, 1999, 0.8),
(4, 1980, 1989, 0.7),
(5, 1970, 1979, 0.6),
(6, 1960, 1969, 0.5);

INSERT INTO PROPERTY
VALUES (5, 1234, 1000, 2),
(6, 123, 112551, 2),
(7, 124, 17899, 2),
(8, 123, 11548, 2),
(9, 45, 333, 1);

SELECT * FROM BUILDYEAR; 
SELECT * FROM PROPERTY;

SELECT PR_ID, BY_BOTTOM_BORDER, BY_TOP_BORDER
FROM PROPERTY INNER JOIN BUILDYEAR ON PR_BUILD_YEAR=BY_ID;

SELECT COUNT(PR_ID), BY_BOTTOM_BORDER A, BY_TOP_BORDER B
FROM PROPERTY INNER JOIN BUILDYEAR ON PR_BUILD_YEAR=BY_ID
GROUP BY BY_BOTTOM_BORDER, BY_TOP_BORDER;

SELECT PR_ID, (CASE 
WHEN BY_BOTTOM_BORDER=1960 AND BY_TOP_BORDER=1969 THEN '1960-1969' 
WHEN BY_BOTTOM_BORDER=1970 AND BY_TOP_BORDER=1979 THEN '1970-1979' 
WHEN BY_BOTTOM_BORDER=1980 AND BY_TOP_BORDER=1989 THEN '1980-1989' 
WHEN BY_BOTTOM_BORDER=1990 AND BY_TOP_BORDER=1999 THEN '1990-1999' 
WHEN BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009 THEN '2000-2009' 
WHEN BY_BOTTOM_BORDER=2010 AND BY_TOP_BORDER=2019 THEN '2010-2019'
END) AS BOTTOM_TOP
FROM PROPERTY INNER JOIN BUILDYEAR ON PR_BUILD_YEAR=BY_ID;

WITH A AS(SELECT PR_ID, (CASE 
WHEN BY_BOTTOM_BORDER=1960 AND BY_TOP_BORDER=1969 THEN '1960-1969' 
WHEN BY_BOTTOM_BORDER=1970 AND BY_TOP_BORDER=1979 THEN '1970-1979' 
WHEN BY_BOTTOM_BORDER=1980 AND BY_TOP_BORDER=1989 THEN '1980-1989' 
WHEN BY_BOTTOM_BORDER=1990 AND BY_TOP_BORDER=1999 THEN '1990-1999' 
WHEN BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009 THEN '2000-2009' 
WHEN BY_BOTTOM_BORDER=2010 AND BY_TOP_BORDER=2019 THEN '2010-2019'
END) AS BOTTOM_TOP
FROM PROPERTY INNER JOIN BUILDYEAR ON PR_BUILD_YEAR=BY_ID
)
SELECT COUNT(PR_ID), BOTTOM_TOP FROM A
GROUP BY BOTTOM_TOP;

SELECT COUNT(PR_ID), (CASE 
WHEN BY_BOTTOM_BORDER=1960 AND BY_TOP_BORDER=1969 THEN '1960-1969' 
WHEN BY_BOTTOM_BORDER=1970 AND BY_TOP_BORDER=1979 THEN '1970-1979' 
WHEN BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009 THEN '1980-1989' 
WHEN BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009 THEN '1990-1999' 
WHEN BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009 THEN '2000-2009' 
WHEN BY_BOTTOM_BORDER=2010 AND BY_TOP_BORDER=2019 THEN '2010-2019'
END) AS BOTTOM_TOP
FROM PROPERTY INNER JOIN BUILDYEAR ON PR_BUILD_YEAR=BY_ID
GROUP BY (CASE 
WHEN BY_BOTTOM_BORDER=1960 AND BY_TOP_BORDER=1969 THEN '1960-1969' 
WHEN BY_BOTTOM_BORDER=1970 AND BY_TOP_BORDER=1979 THEN '1970-1979' 
WHEN BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009 THEN '1980-1989' 
WHEN BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009 THEN '1990-1999' 
WHEN BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009 THEN '2000-2009' 
WHEN BY_BOTTOM_BORDER=2010 AND BY_TOP_BORDER=2019 THEN '2010-2019'
END);

SELECT COUNT(PR_ID), IF( 
BY_BOTTOM_BORDER=1960 AND BY_TOP_BORDER=1969, '1960-1969' 
BY_BOTTOM_BORDER=1970 AND BY_TOP_BORDER=1979, '1970-1979' 
BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009, '1980-1989' 
BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009, '1990-1999' 
BY_BOTTOM_BORDER=2000 AND BY_TOP_BORDER=2009, '2000-2009' 
BY_BOTTOM_BORDER=2010 AND BY_TOP_BORDER=2019, '2010-2019')
AS BOTTOM_TOP
FROM PROPERTY INNER JOIN BUILDYEAR ON PR_BUILD_YEAR=BY_ID
GROUP BY BOTTOM_TOP;
